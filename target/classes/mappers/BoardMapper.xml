<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="board">
	<!-- dboard 테이블의 clob 형식의 컬럼을 위한 resultMap 정의 -->
	<resultMap type='com.daesungra.domain.BoardVo' id='getBoardVoIncludeClobType'>
		<!-- dboard -->
		<result property='serial' column='serial' />
		<result property='bookNo' column='bookNo' />
		<result property='title' column='title' />
		<result property='content' column='content' jdbcType='CLOB' javaType='java.lang.String' />
		<result property='category' column='category' />
		<result property='userId' column='userId' />
		<result property='bDate' column='bDate' />
		<result property='hit' column='hit' />
		<result property='gSerial' column='gSerial' />
		<result property='pSerial' column='pSerial' />
		<result property='depth' column='depth' />
		<result property='indent' column='indent' />
		<result property='isDelete' column='isDelete' />
		<!-- dbook -->
		<result property='title_kor' column='title_kor' />
		<result property='title_eng' column='title_eng' />
		<result property='introduce' column='introduce' />
		<result property='author' column='author' />
		<result property='publisher' column='publisher' />
		<result property='country' column='country' />
		<result property='coverImg' column='coverImg' />
		<result property='pDate' column='pDate' />
	</resultMap>

	<!-- select list -->
	<select id="boardListDate" parameterType="int" resultMap="getBoardVoIncludeClobType">
		SELECT * FROM (
			SELECT ROWNUM rno, s.* FROM (
				SELECT bd.serial serial, bd.bookNo bookNo, bd.title title, bd.content content, bd.category category, bd.userId userId, to_char(bd.bDate, 'YYYY.MM.DD') bDate, bd.hit hit,
						bk.title_kor title_kor, bk.title_eng title_eng, bk.author author, bk.coverImg coverImg, to_char(bk.pDate, 'YYYY') pDate
					FROM DBOARD bd join DBOOK bk
					ON bd.bookNo = bk.bookNo
					WHERE bd.category = #{category} and bd.isDelete = 0
					ORDER BY bd.bDate desc, bd.hit desc
			) s
		) WHERE rno BETWEEN 1 and 20
	</select>
	<select id="boardListHit" parameterType="int" resultMap="getBoardVoIncludeClobType">
		SELECT * FROM (
			SELECT ROWNUM rno, s.* FROM (
				SELECT bd.serial serial, bd.bookNo bookNo, bd.title title, bd.content content, bd.category category, bd.userId userId, to_char(bd.bDate, 'YYYY.MM.DD') bDate, bd.hit hit,
						bk.title_kor title_kor, bk.title_eng title_eng, bk.author author, bk.coverImg coverImg, to_char(bk.pDate, 'YYYY') pDate
					FROM DBOARD bd join DBOOK bk
					ON bd.bookNo = bk.bookNo
					WHERE bd.category = #{category} and bd.isDelete = 0
					ORDER BY bd.hit desc, bd.bDate desc
			) s
		) WHERE rno BETWEEN 1 and 20
	</select>
	<select id="selectBookInfo" parameterType="String" resultType="com.daesungra.domain.BookVo">
		SELECT bookNo, title_kor, title_eng, introduce, author, category, publisher, country, coverImg, to_char(pDate, 'YYYY') pDate, isPermitted
			FROM DBOOK
			WHERE bookNo like '%${_parameter}%' or title_kor like '%${_parameter}%' or title_eng like '%${_parameter}%' or introduce like '%${_parameter}%' or author like '%${_parameter}%'
	</select>
</mapper>